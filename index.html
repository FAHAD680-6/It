<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Address Book (LW12)</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        input[type="text"] { padding: 8px; margin-bottom: 10px; width: 100%; box-sizing: border-box; }
        .form-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .form-group > div { flex: 1 1 45%; }
        #contact_list_area table { border-collapse: collapse; margin-top: 15px; }
        #contact_list_area th, #contact_list_area td { padding: 8px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h2>Add a contact to the address book:</h2>

    <form id="addContactForm">
        <div class="form-group">
            <div>
                <label for="first_name">First name:*</label>
                <input type="text" id="first_name" name="first_name" required>
            </div>
            <div>
                <label for="last_name">Last name:*</label>
                <input type="text" id="last_name" name="last_name" required>
            </div>
            <div>
                <label for="street">Street:*</label>
                <input type="text" id="street" name="street" required>
            </div>
            <div>
                <label for="city">City:*</label>
                <input type="text" id="city" name="city" required>
            </div>
            <div>
                <label for="state">State:*</label>
                <input type="text" id="state" name="state" required>
            </div>
            <div>
                <label for="zip">Zip:*</label>
                <input type="text" id="zip" name="zip" required>
            </div>
        </div>
        <button type="submit">Submit</button>
        <button type="reset">Clear</button>
    </form>
    <hr>
    <h3>Search the address book by last name:</h3>
    <div>
        <label for="search_last_name">Last name:</label>
        <input type="text" id="search_last_name" placeholder="Start typing last name..." onkeyup="searchContacts()">
    </div>
    <hr>
    <div id="contact_list_area">
        </div>
</div>
<script>
    // --- AJAX Function to Load/Update Contacts (Used by both Search and Initial Load) ---
    function loadContacts(searchTerm = '', action = 'initial_load') {
        const xhr = new XMLHttpRequest();
        // Target the separate PHP file: handler.php
        xhr.open('POST', 'handler.php', true); 
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        xhr.onload = function() {
            if (this.status === 200) {
                document.getElementById('contact_list_area').innerHTML = this.responseText;
            } else {
                console.error("Error loading contacts. Status: " + this.status);
            }
        };
        let data = 'action=' + encodeURIComponent(action);
        if (searchTerm) {
             data += '&search_term=' + encodeURIComponent(searchTerm);
        }
        xhr.send(data);
    }
    document.getElementById('addContactForm').addEventListener('submit', function(e) {
        e.preventDefault(); 
        const form = e.target;
        const formData = new FormData(form);
        formData.append('action', 'insert');     
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'handler.php', true);      
        xhr.onload = function() {
            if (this.status === 200) {
                document.getElementById('contact_list_area').innerHTML = this.responseText;
                form.reset(); 
                alert('Contact added successfully!');
            } else {
                 alert('Error inserting contact.');
            }
        };
        xhr.send(new URLSearchParams(formData));
    });
    function searchContacts() {
        const searchTerm = document.getElementById('search_last_name').value;
        loadContacts(searchTerm, 'search'); 
    }
    window.onload = function() {
        loadContacts('', 'initial_load');
    };
</script>
</body>
</html>